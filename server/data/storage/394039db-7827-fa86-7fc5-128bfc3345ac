#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>         // gethostname()
#include <arpa/inet.h>      // inet_pton(), inet_ntop(), htons(), ntohs(), ...
#include <netdb.h>          // gethostbyname()
#include <netinet/in.h>     // struct in_addr

int main() {
    char hostname[256];
    struct hostent *host_entry;
    struct in_addr **addr_list;
    char ip_str[INET_ADDRSTRLEN];
    struct in_addr addr;

    // ===============================
    // 1️⃣ gethostname(): Lấy tên hệ thống (tên distro / máy)
    // ===============================
    if (gethostname(hostname, sizeof(hostname)) == -1) {
        perror("gethostname");
        return 1;
    }
    printf("Hostname: %s\n", hostname);

    // ===============================
    // 2️⃣ gethostbyname(): Lấy IP từ hostname
    // ===============================
    host_entry = gethostbyname(hostname);
    if (host_entry == NULL) {
        herror("gethostbyname");
        return 1;
    }

    printf("Official name: %s\n", host_entry->h_name);
    addr_list = (struct in_addr **) host_entry->h_addr_list;

    for (int i = 0; addr_list[i] != NULL; i++) {
        printf("IP Address #%d: %s\n", i + 1, inet_ntoa(*addr_list[i]));
    }

    // ===============================
    // 3️⃣ htons(), ntohs(): chuyển byte order
    // ===============================
    unsigned short port = 8080;
    unsigned short port_net = htons(port);  // host → network
    unsigned short port_host = ntohs(port_net); // network → host

    printf("\nHost port: %u -> Network order: %u -> Back to Host: %u\n",
           port, port_net, port_host);

    // ===============================
    // 4️⃣ inet_aton(), inet_ntoa(): chuyển giữa string ↔ struct in_addr
    // ===============================
    const char *ip_str_in = "192.168.1.1";
    if (inet_aton(ip_str_in, &addr)) {
        printf("\ninet_aton(): %s -> %u\n", ip_str_in, addr.s_addr);
        printf("inet_ntoa(): %u -> %s\n", addr.s_addr, inet_ntoa(addr));
    } else {
        printf("inet_aton() failed\n");
    }

    // ===============================
    // 5️⃣ inet_pton(), inet_ntop(): IPv4 & IPv6 conversion
    // ===============================
    struct in_addr ipv4_addr;
    struct in6_addr ipv6_addr;
    char ipv4_text[INET_ADDRSTRLEN];
    char ipv6_text[INET6_ADDRSTRLEN];

    // IPv4 string → binary
    inet_pton(AF_INET, "8.8.8.8", &ipv4_addr);
    // binary → string
    inet_ntop(AF_INET, &ipv4_addr, ipv4_text, sizeof(ipv4_text));
    printf("\nIPv4 conversion: 8.8.8.8 -> %u -> %s\n",
           ipv4_addr.s_addr, ipv4_text);

    // IPv6 string → binary
    inet_pton(AF_INET6, "2001:4860:4860::8888", &ipv6_addr);
    // binary → string
    inet_ntop(AF_INET6, &ipv6_addr, ipv6_text, sizeof(ipv6_text));
    printf("IPv6 conversion: 2001:4860:4860::8888 -> (binary) -> %s\n",
           ipv6_text);

    return 0;
}
